{
  "id": "src/orch/server.py",
  "role": "entrypoint",
  "public_api": [
    "GET /healthz",
    "POST /v1/chat/completions"
  ],
  "summary": "FastAPIエントリポイント。設定を読み込みProviderRegistry/RoutePlanner/ProviderGuardsを初期化し、RPM/TPM統合ガード越しにフォールバック順でプロバイダ呼び出しを実行。SSE/非SSEを動的に切り替えつつPrometheusメトリクスとJSONLログへ書き出す。",
  "deps_out": [
    "src/orch/router.py",
    "src/orch/providers/__init__.py",
    "src/orch/rate_limiter.py",
    "src/orch/metrics.py",
    "src/orch/types.py"
  ],
  "deps_in": [],
  "risks": [
    "SSE接続はクライアント切断までGuard/HTTPリソースを保持し続ける",
    "フォールバック連鎖でRPM/TPM在庫が枯渇すると再試行が遅延または失敗する",
    "Prometheus/JSONL出力とTPMバケットの設定ズレでメトリクス/制限値の解釈が狂う"
  ],
  "tests": [
    "tests/test_server_routes.py",
    "tests/test_health.py"
  ]
}
